
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SentinelID</title>
    <style>
        body { font-family: Segoe UI; background: linear-gradient(135deg, #667eea, #764ba2); min-height: 100vh; display: flex; align-items: center; justify-content: center; padding: 20px; }
        .container { background: white; border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); width: 100%; max-width: 900px; }
        .header { background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 30px; text-align: center; }
        .content { padding: 30px; max-height: 80vh; overflow-y: auto; }
        .auth-container { display: none; }
        .auth-container.active { display: block; }
        .dashboard { display: none; }
        .dashboard.active { display: block; }
        .auth-tabs { display: flex; gap: 10px; border-bottom: 2px solid #eee; margin-bottom: 30px; }
        .tab-btn { background: none; border: none; padding: 12px 20px; cursor: pointer; color: #999; border-bottom: 3px solid transparent; transition: 0.3s; }
        .tab-btn.active { color: #667eea; border-bottom-color: #667eea; }
        .auth-form { display: none; }
        .auth-form.active { display: block; }
        .form-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; font-weight: 600; }
        input, textarea { width: 100%; padding: 12px; border: 2px solid #eee; border-radius: 8px; }
        input:focus, textarea:focus { outline: none; border-color: #667eea; }
        button { width: 100%; padding: 12px; background: #667eea; color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; }
        button:hover { background: #5568d3; }
        .welcome-banner { background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 20px; border-radius: 12px; margin-bottom: 30px; text-align: center; }
        .metrics { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px; }
        .metric-card { background: #f8f9fa; padding: 20px; border-radius: 12px; border-left: 4px solid #667eea; }
        .metric-label { font-size: 12px; color: #999; text-transform: uppercase; margin-bottom: 10px; }
        .metric-value { font-size: 32px; font-weight: bold; }
        .confidence-bar { background: #eee; height: 12px; border-radius: 6px; overflow: hidden; margin: 20px 0; }
        .confidence-fill { background: linear-gradient(90deg, #667eea, #764ba2); height: 100%; transition: width 0.3s; display: flex; align-items: center; justify-content: center; font-size: 10px; color: white; }
        .input-area { background: #f8f9fa; padding: 20px; border-radius: 12px; margin-bottom: 20px; }
        .input-area textarea { min-height: 100px; }
        .stats-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-top: 20px; }
        .stat { background: white; padding: 15px; border-radius: 8px; border: 1px solid #eee; text-align: center; }
        .stat-value { font-size: 24px; font-weight: bold; color: #667eea; margin-bottom: 5px; }
        .stat-label { font-size: 12px; color: #999; }
        .events-log { margin-top: 30px; background: #f8f9fa; padding: 20px; border-radius: 12px; max-height: 200px; overflow-y: auto; }
        .event { padding: 10px; margin-bottom: 10px; background: white; border-left: 4px solid #667eea; border-radius: 4px; font-size: 13px; }
        .logout-btn { background: #ff6b6b; margin-top: 20px; }
        .message { padding: 12px; border-radius: 8px; margin-bottom: 20px; text-align: center; }
        .message.success { background: #d4edda; color: #155724; }
        .message.error { background: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üõ°Ô∏è SentinelID</h1>
            <p>Adaptive Behavioral Authentication</p>
        </div>
        <div class="content">
            <div class="auth-container active">
                <div class="auth-tabs">
                    <button class="tab-btn active" data-tab="login">Login</button>
                    <button class="tab-btn" data-tab="register">Register</button>
                </div>
                <div id="message"></div>
                <div id="login" class="auth-form active">
                    <div class="form-group">
                        <label>Username</label>
                        <input type="text" id="login-username" placeholder="Enter username">
                    </div>
                    <div class="form-group">
                        <label>Password</label>
                        <input type="password" id="login-password" placeholder="Enter password">
                    </div>
                    <button onclick="login()">Login</button>
                </div>
                <div id="register" class="auth-form">
                    <div class="form-group">
                        <label>Username</label>
                        <input type="text" id="register-username">
                    </div>
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="register-email">
                    </div>
                    <div class="form-group">
                        <label>Password</label>
                        <input type="password" id="register-password">
                    </div>
                    <button onclick="register()">Create Account</button>
                </div>
            </div>
            <div class="dashboard">
                <div class="welcome-banner">
                    <h2>Welcome, <span id="username-display">User</span>! üëã</h2>
                    <p>Continuous Behavioral Authentication Active</p>
                </div>
                <div class="metrics">
                    <div class="metric-card">
                        <div class="metric-label">Session Confidence</div>
                        <div class="metric-value" id="confidence">100%</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">Anomalies Detected</div>
                        <div class="metric-value" id="anomalies">0</div>
                    </div>
                </div>
                <div class="confidence-bar">
                    <div class="confidence-fill" id="confidence-bar" style="width: 100%;">100%</div>
                </div>
                <div class="input-area">
                    <label>üí¨ Type here to build your behavioral profile...</label>
                    <textarea id="input-text" placeholder="Type naturally..."></textarea>
                    <div class="stats-grid">
                        <div class="stat">
                            <div class="stat-value" id="keystroke-count">0</div>
                            <div class="stat-label">üî§ Keystroke Count</div>
                        </div>
                        <div class="stat">
                            <div class="stat-value" id="mouse-events">0</div>
                            <div class="stat-label">üñ±Ô∏è Mouse Events</div>
                        </div>
                        <div class="stat">
                            <div class="stat-value" id="typing-speed">0</div>
                            <div class="stat-label">‚ö° Typing Speed (WPM)</div>
                        </div>
                        <div class="stat">
                            <div class="stat-value" id="real-confidence">--</div>
                            <div class="stat-label">üõ°Ô∏è Confidence Score</div>
                        </div>
                    </div>
                </div>
                <div class="events-log">
                    <h3>üìù Session Events</h3>
                    <div id="events-container">
                        <div class="event"><span style="color:#667eea;font-weight:bold;">[Connected]</span> üöÄ SentinelID initialized</div>
                    </div>
                </div>
                <button class="logout-btn" onclick="logout()">Logout</button>
            </div>
        </div>
    </div>
    <script>
        const API_BASE = 'http://127.0.0.1:5000';
        let token = localStorage.getItem('token');
        let keystrokeCount = 0, mouseCount = 0, typingStartTime = null;
        
        if (token) showDashboard();
        
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                document.querySelectorAll('.auth-form').forEach(f => f.classList.remove('active'));
                this.classList.add('active');
                document.getElementById(this.dataset.tab).classList.add('active');
            });
        });
        
        async function register() {
            const username = document.getElementById('register-username').value;
            const email = document.getElementById('register-email').value;
            const password = document.getElementById('register-password').value;
            if (!username || !email || !password) {
                showMessage('Fill all fields', 'error');
                return;
            }
            try {
                const response = await fetch(`${API_BASE}/api/auth/register`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, email, password })
                });
                const data = await response.json();
                if (response.ok) {
                    showMessage('Registration successful!', 'success');
                    setTimeout(() => document.querySelector('[data-tab="login"]').click(), 1500);
                } else {
                    showMessage(data.message || 'Failed', 'error');
                }
            } catch (error) {
                showMessage('Error: ' + error.message, 'error');
            }
        }
        
        async function login() {
            const username = document.getElementById('login-username').value;
            const password = document.getElementById('login-password').value;
            if (!username || !password) {
                showMessage('Fill all fields', 'error');
                return;
            }
            try {
                const response = await fetch(`${API_BASE}/api/auth/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, password })
                });
                const data = await response.json();
                if (response.ok) {
                    token = data.access_token;
                    localStorage.setItem('token', token);
                    localStorage.setItem('username', username);
                    showMessage('Login successful!', 'success');
                    setTimeout(showDashboard, 1000);
                } else {
                    showMessage(data.message || 'Failed', 'error');
                }
            } catch (error) {
                showMessage('Error', 'error');
            }
        }
        
        function logout() {
            token = null;
            localStorage.clear();
            keystrokeCount = 0;
            mouseCount = 0;
            document.querySelector('.auth-container').classList.add('active');
            document.querySelector('.dashboard').classList.remove('active');
        }
        
        function showDashboard() {
            document.querySelector('.auth-container').classList.remove('active');
            document.querySelector('.dashboard').classList.add('active');
            document.getElementById('username-display').textContent = localStorage.getItem('username');
            setupTracking();
        }
        
        function showMessage(msg, type) {
            const el = document.getElementById('message');
            el.innerHTML = `<div class="message ${type}">${msg}</div>`;
            setTimeout(() => el.innerHTML = '', 5000);
        }
        
        function setupTracking() {
            const input = document.getElementById('input-text');
            input.addEventListener('keydown', () => {
                if (!typingStartTime) typingStartTime = Date.now();
                keystrokeCount++;
                document.getElementById('keystroke-count').textContent = keystrokeCount;
                if (keystrokeCount > 0) {
                    const wpm = Math.round(keystrokeCount / 5 / ((Date.now() - typingStartTime) / 60000)) || 0;
                    document.getElementById('typing-speed').textContent = wpm;
                }
                updateConfidence();
            });
            document.addEventListener('mousemove', () => {
                mouseCount++;
                document.getElementById('mouse-events').textContent = mouseCount;
                updateConfidence();
            });
        }
        
        function updateConfidence() {
            let conf = keystrokeCount < 10 ? 100 - (10 - keystrokeCount) * 2 : 85 + Math.random() * 10;
            conf = Math.min(100, Math.max(0, conf));
            document.getElementById('confidence').textContent = Math.round(conf) + '%';
            document.getElementById('real-confidence').textContent = Math.round(conf) + '%';
            document.getElementById('confidence-bar').style.width = conf + '%';
        }
    </script>
</body>
</html>
